# 'Allow scripts to access the OAuth token' was selected in pipeline.  Add the following YAML to any steps requiring access:
#       env:
#           MY_ACCESS_TOKEN: $(System.AccessToken)
# Variable 'system.prefergit' was defined in the Variables tab
name: $(date:yyMM).$(date:dd)$(rev:rrr)
resources:
  repositories:
  - repository: self
    type: git
    ref: main
pool:
  name: Azure Pipelines
  vmImage: ubuntu-20.04
  demands:
  - npm

parameters:
- name: adaptivecards_prerelease_identifier
  displayName: "[adaptivecards] Prerelease identifier, used only if prerelease indicated above"
  type: string
  default: 'beta'

- name: adaptivecards_controls_prerelease_identifier
  displayName: "[adaptivecards-controls] Prerelease identifier, used only if prerelease indicated above"
  type: string
  default: 'beta'

- name: adaptivecards_designer_prerelease_identifier
  displayName: "[adaptivecards-designer] Prerelease identifier, used only if prerelease indicated above"
  type: string
  default: 'beta'

- name: adaptivecards_templating_prerelease_identifier
  displayName: "[adaptivecards-templating] Prerelease identifier, used only if prerelease indicated above"
  type: string
  default: 'beta'

variables:
- name: AC_ADAPTIVECARDS_PRERELEASE_IDENTIFIER
  value: ${{ parameters.adaptivecards_prerelease_identifier }}
- name: AC_ADAPTIVECARDS_CONTROLS_PRERELEASE_IDENTIFIER
  value: ${{ parameters.adaptivecards_controls_prerelease_identifier }}
- name: AC_ADAPTIVECARDS_DESIGNER_PRERELEASE_IDENTIFIER
  value: ${{ parameters.adaptivecards_designer_prerelease_identifier }}
- name: AC_ADAPTIVECARDS_TEMPLATING_PRERELEASE_IDENTIFIER
  value: ${{ parameters.adaptivecards_templating_prerelease_identifier }}

steps:
- task: NodeTool@0
  name: NodeTool1
  displayName: Use Node 12.x
  inputs:
    versionSpec: 12.x
- bash: |
   npm ci 
   npx lerna bootstrap --ci
   npx lerna run release
   npm version prerelease --preid beta --no-git-tag-version --no-push --yes
  workingDirectory: source/nodejs
  displayName: 'Bash - lerna bootstrap'